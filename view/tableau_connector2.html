<html>
<head>
    <title>json Connector</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" type="text/javascript"></script>
    <script src="https://public.tableau.com/javascripts/api/tableauwdc-1.1.0.js" type="text/javascript"></script>
    <script type="text/javascript">

        (function() {

            var myConnector = tableau.makeConnector();

            myConnector.init = function () {
                tableau.connectionName = 'JSON data';
                tableau.initCallback();
            };

            myConnector.getColumnHeaders = function() {
                _retrieveJsonData(function (tableData) {
                    var header = tableData.header;
                    console.log(header);
                    tableau.headersCallback(header.names, header.types);
                });
            };

            myConnector.getTableData = function (lastRecordToken) {
                _retrieveJsonData(function (tableData) {
                    var rowData = tableData.rowData;
                    console.log(rowData);
                    tableau.dataCallback(rowData, rowData.length.toString(), false);
                });
            };

            tableau.registerConnector(myConnector);
        })();

        function _retrieveJsonData(retrieveDataCallback) {
            retrieveDataCallback(JSON.parse(tableau.connectionData));
        }

        function _submitToJsonToTableau() {
            var conData;

            var fieldNames = ['id', 'frussssssit', 'color'];
            var fieldTypes = ['int', 'string', 'string'];

            var tableData = [];
            tableData.push([1, 'asdfasdfsadfsad', 'red']);
            tableData.push([2, 'asfsad', 'orange']);
            tableData.push([3, 'asdfas', 'yellow']);
            tableData.push([4, 'asdfasdf', 'brown']);

            var header={"names" : fieldNames, types: fieldTypes};
            conData={"header": header, "rowData": tableData};

            tableau.connectionData = JSON.stringify(conData);
            tableau.submit();
        }

    </script>
</head>
<body>
<button id="submit" onclick="_submitToJsonToTableau()">Submit</button>

</body>
</html>
